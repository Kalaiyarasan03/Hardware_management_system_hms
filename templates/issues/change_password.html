{% extends 'issues/base.html' %}

{% block content %}
<style>
    .change-password-container {
        max-width: 500px;
        margin: 2rem auto;
        padding: 0 1rem;
    }

    .page-header {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        padding: 2rem;
        border-radius: 20px;
        margin-bottom: 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
    }

    .page-header h1 {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .page-header p {
        font-size: 0.95rem;
        opacity: 0.9;
        margin: 0;
    }

    .form-container {
        background: white;
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        border: 1px solid #e2e8f0;
    }

    .security-notice {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border: 1px solid #f59e0b;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 2rem;
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .security-notice i {
        color: #d97706;
        margin-top: 0.25rem;
        flex-shrink: 0;
    }

    .security-notice-content h4 {
        color: #92400e;
        font-size: 1rem;
        font-weight: 600;
        margin: 0 0 0.5rem 0;
    }

    .security-notice-content p {
        color: #92400e;
        font-size: 0.875rem;
        margin: 0;
        line-height: 1.4;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
    }

    .form-control {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        color: #374151;
        background: white;
        transition: all 0.3s ease;
        box-sizing: border-box;
    }

    .form-control:focus {
        outline: none;
        border-color: #ef4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }

    .password-requirements {
        background: #f8fafc;
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1rem;
        border-left: 4px solid #6b7280;
    }

    .password-requirements h5 {
        color: #374151;
        font-size: 0.875rem;
        font-weight: 600;
        margin: 0 0 0.5rem 0;
    }

    .requirements-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .requirements-list li {
        font-size: 0.8rem;
        color: #6b7280;
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .requirements-list i {
        width: 12px;
        text-align: center;
    }

    .error-message {
        background: #fee2e2;
        border: 1px solid #fecaca;
        color: #991b1b;
        padding: 0.75rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        font-size: 0.875rem;
    }

    .error-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .error-list li {
        margin-bottom: 0.25rem;
    }

    .success-message {
        background: #d1fae5;
        border: 1px solid #a7f3d0;
        color: #065f46;
        padding: 0.75rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        font-size: 0.875rem;
    }

    .btn-group {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
        padding-top: 2rem;
        border-top: 2px solid #e5e7eb;
        margin-top: 2rem;
    }

    .btn {
        padding: 0.875rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        border: none;
        min-height: 44px;
        justify-content: center;
    }

    .btn:hover {
        transform: translateY(-1px);
    }

    .btn-danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    .btn-danger:hover {
        box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
    }

    .btn-secondary {
        background: #f8fafc;
        color: #374151;
        border: 2px solid #e5e7eb;
    }

    .btn-secondary:hover {
        background: #f1f5f9;
        border-color: #d1d5db;
    }

    .help-text {
        font-size: 0.8rem;
        color: #6b7280;
        margin-top: 0.25rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .change-password-container {
            padding: 0 0.75rem;
            margin: 1rem auto;
        }

        .page-header {
            padding: 1.5rem 1rem;
            margin-bottom: 1.5rem;
        }

        .page-header h1 {
            font-size: 1.5rem;
        }

        .form-container {
            padding: 1.5rem;
        }

        .btn-group {
            flex-direction: column-reverse;
        }

        .btn {
            width: 100%;
        }

        .security-notice {
            flex-direction: column;
            text-align: center;
        }
    }

    @media (max-width: 480px) {
        .change-password-container {
            padding: 0 0.5rem;
        }

        .form-container {
            padding: 1rem;
        }

        .page-header {
            padding: 1rem 0.75rem;
        }

        .page-header h1 {
            font-size: 1.25rem;
        }
    }
</style>

<div class="change-password-container">
    <!-- Page Header -->
    <div class="page-header">
        <h1><i class="fas fa-key"></i> Change Password</h1>
        <p>Update your account password for better security</p>
    </div>

    <!-- Display Messages -->
    {% if messages %}
        {% for message in messages %}
            <div class="{% if message.tags == 'error' %}error-message{% else %}success-message{% endif %}">
                <i class="fas fa-{% if message.tags == 'error' %}exclamation-triangle{% else %}check-circle{% endif %}"></i>
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Change Password Form -->
    <div class="form-container">
        <!-- Security Notice -->
        <div class="security-notice">
            <i class="fas fa-shield-alt"></i>
            <div class="security-notice-content">
                <h4>Security Notice</h4>
                <p>Choose a strong password to protect your account. After changing your password, you'll remain logged in on this device.</p>
            </div>
        </div>

        <form method="post">
            {% csrf_token %}
            
            <!-- Current Password -->
            <div class="form-group">
                <label for="{{ form.old_password.id_for_label }}" class="form-label">
                    <i class="fas fa-lock"></i> Current Password
                </label>
                {{ form.old_password }}
                <div class="help-text">Enter your current password to verify your identity</div>
                {% if form.old_password.errors %}
                    <div class="error-message">
                        <ul class="error-list">
                            {% for error in form.old_password.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>

            <!-- New Password -->
            <div class="form-group">
                <label for="{{ form.new_password1.id_for_label }}" class="form-label">
                    <i class="fas fa-key"></i> New Password
                </label>
                {{ form.new_password1 }}
                {% if form.new_password1.errors %}
                    <div class="error-message">
                        <ul class="error-list">
                            {% for error in form.new_password1.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>

            <!-- Confirm New Password -->
            <div class="form-group">
                <label for="{{ form.new_password2.id_for_label }}" class="form-label">
                    <i class="fas fa-key"></i> Confirm New Password
                </label>
                {{ form.new_password2 }}
                <div class="help-text">Enter the same password as above for verification</div>
                {% if form.new_password2.errors %}
                    <div class="error-message">
                        <ul class="error-list">
                            {% for error in form.new_password2.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}
            </div>

            <!-- Password Requirements -->
            <div class="password-requirements">
                <h5><i class="fas fa-info-circle"></i> Password Requirements</h5>
                <ul class="requirements-list">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        At least 8 characters long
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        Cannot be too similar to your personal information
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        Cannot be a commonly used password
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        Cannot be entirely numeric
                    </li>
                </ul>
            </div>

            <!-- Action Buttons -->
            <div class="btn-group">
                <a href="{% url 'issues:profile' %}" class="btn btn-secondary">
                    <i class="fas fa-times"></i>
                    Cancel
                </a>
                <button type="submit" class="btn btn-danger">
                    <i class="fas fa-save"></i>
                    Change Password
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation and submission
    const form = document.querySelector('form');
    const submitBtn = form.querySelector('button[type="submit"]');
    
    form.addEventListener('submit', function(e) {
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Changing...';
        submitBtn.disabled = true;
    });
    
    // Password strength indicator (optional enhancement)
    const newPasswordField = document.getElementById('{{ form.new_password1.id_for_label }}');
    if (newPasswordField) {
        newPasswordField.addEventListener('input', function(e) {
            // You can add password strength validation here
            const password = e.target.value;
            const requirements = document.querySelectorAll('.requirements-list i');
            
            // Check length
            if (password.length >= 8) {
                requirements[0].className = 'fas fa-check-circle';
                requirements[0].style.color = '#10b981';
            } else {
                requirements[0].className = 'fas fa-times-circle';
                requirements[0].style.color = '#ef4444';
            }
        });
    }
    
    // Animation on load
    const container = document.querySelector('.form-container');
    container.style.opacity = '0';
    container.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
        container.style.transition = 'all 0.6s ease';
        container.style.opacity = '1';
        container.style.transform = 'translateY(0)';
    }, 100);
});
</script>

{% endblock %}